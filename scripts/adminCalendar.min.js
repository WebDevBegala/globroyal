var gameTypes=["B2","B3","B4","B5","B6","B7","D1","D2"],daysName=[""],gHours=[],allDays=[],freeDays=[],date,gDay,betweenDate=[];function getScheduleRendered(){if(sessionStorage.date){let d=new Date(sessionStorage.date),year,month,day,dateString=d.getFullYear()+"-"+(d.getMonth()<9?"0"+Number(d.getMonth()+1):Number(d.getMonth()+1))+"-"+(d.getDate()<9?"0"+d.getDate():d.getDate());$("#newdate").val(dateString),selectDay(d.getDate())}else{let d=new Date,year,month,day,dateString=d.getFullYear()+"-"+(d.getMonth()<9?"0"+Number(d.getMonth()+1):Number(d.getMonth()+1))+"-"+(d.getDate()<9?"0"+d.getDate():d.getDate());date=dateString,$("#newdate").val(dateString),selectDay(d.getDate())}}function renderDays(year,month){var calendarContent=$(".calendar-content");$(".calendar-content").html("");let d=new Date(year,month,0);for(let i=1;i<d.getDate()+1;i++)$(".calendar-content").append('\n    <div class="c-block" onclick="selectDay('+i+')" ><p style="margin:0.5em" >'+i+"</p></div>\n    ")}const selectDay=dayI=>{let d=new Date(date||sessionStorage.date),year=d.getFullYear(),month=d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1,day=d.getDate()<9?"0"+Number(d.getDate()):Number(d.getDate()),dateString;date=year+"-"+month+"-"+day,$(".calendar-content").html(""),$(".calendar-content").addClass("calendar-times").removeClass("calendar-content"),getFreePos(date),getOpenHoursWithParam(d.getDay())};function selectDayOther(date){$(".calendar-times").html(""),$(".calendar-content").html(""),$(".calendar-content").addClass("calendar-times").removeClass("calendar-content"),getFreePos(date),getOpenHoursWithParam(date.getDay())}function getOpenHours(date){gHours=[];let d=new Date;$.post(apiUrl+"getOpenHours.php",{day:d.getDay()},(res,status)=>{let start=Number(res.opening),end=res.closing,diff;diff=start>end?24-Number(start)+Number(end):end-start;for(let i=0;i<diff;i+=2){let d=new Date;d.setHours(Number(start)+i);let hours=d.getHours();gHours.push(hours)}})}function back(){let d=new Date,year=d.getFullYear(),month=d.getMonth(),day=d.getDate();$(".calendar-times").html(""),$(".calendar-times").addClass("calendar-content").removeClass("calendar-times"),renderDays(year,month)}function getFreePos(date){$.ajax({type:"POST",url:apiUrl+"getAdminReservations.php",data:"data="+JSON.stringify({date:date}),dataType:"JSON",success:function(response){let array=[];for(let i=0;i<response.length;i++)array.push({time:Number(response[i].time),name:response[i].name,email:response[i].email,phone:response[i].phone,gameType:response[i].gameType,coupon:response[i].coupon,desc:response[i].desc,free:response[i].free,rank:response[i].rank});generateDay(array)},error:function(err){console.log(err)}})}function generateDay(otherArray){setTimeout((function(){let array=[];for(let i=0;i<gHours.length;i++)for(let j=0;j<gameTypes.length;j++)array.push({time:gHours[i],gameType:gameTypes[j]});generateFreeDays(array,otherArray)}),100)}function generateFreeDays(allArray,freeArray){freeDays=[];let array=allArray;for(let i=0;i<allArray.length;i++)for(let j=0;j<freeArray.length;j++)array[i].gameType==freeArray[j].gameType&&array[i].time==freeArray[j].time&&(array[i].free=!1,array[i].name=freeArray[j].name,array[i].email=freeArray[j].email,array[i].phone=freeArray[j].phone,array[i].coupon=freeArray[j].coupon,array[i].desc=freeArray[j].desc,array[i].rank=freeArray[j].rank);freeDays=array,generateHtml()}function generateHtml(){if($(".calendar-times").html(""),$(".times-table").html(""),0==gHours.length)$(".calendar-times").html("<h3>Ma zárva van</h3>");else{for(let i=0;i<gHours.length;i++)25==Number(gHours[i]+1)?$(".calendar-times").append('\n                <div class="times-table">\n                    <div class="time">\n                        <p>'+gHours[i]+":00  -  02:00</p>\n                    </div>\n                 </div>"):$(".calendar-times").append('\n                <div class="times-table">\n                    <div class="time">\n                        <p>'+gHours[i]+":00  - "+Number(gHours[i]+2)+":00</p>\n                    </div>\n                 </div>");for(let i=0;i<gHours.length;i++)freeDays.forEach((e,j)=>{if(Number(e.time)===Number(gHours[i]))if(0==e.free)switch(Number(e.rank)){case 1:"B"==e.gameType.substr(0,1)?e.coupon?$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:orange;border:1px solid red' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > "):$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:orange' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > "):e.coupon?$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:yellow;border:1px solid red' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > "):$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:yellow' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > ");break;case 2:"B"==e.gameType.substr(0,1)?e.coupon?$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:lightblue;border:1px solid red' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > "):$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:lightblue' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > "):e.coupon?$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:lightgreen;border:1px solid red' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > "):$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:lightgreen' title='Név: "+e.name+"' class= 'game-type' onclick='getScheduleInfo("+j+")'><p>"+e.gameType+"</p></div > ");break;case 3:"VIP"==e.name?$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:gold' class= 'game-type' onclick='vipInfo("+j+")'><p>"+e.gameType+"</p></div > "):e.coupon?$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:khaki;border:1px solid red' title='Név: "+e.name+"' class= 'game-type' onclick='vipInfo("+j+")'><p>"+e.gameType+"</p></div > "):$(".times-table:nth-child("+(i+1)+")").append("<div style = 'background-color:khaki' title='Név: "+e.name+"' class= 'game-type' onclick='vipInfo("+j+")'><p>"+e.gameType+"</p></div > ")}else $(".times-table").eq(i).append("<div class= 'game-type' onclick='setAdminSchedule("+j+")' ><p>"+e.gameType+"</p></div > ")})}}let index;function getScheduleInfo(j){$(".settings-panel").css("display","flex"),index=j,adminGameData=freeDays[index];let data=freeDays[j];$("#newGameType").val(data.gameType),$(".schedule-info").css("display","flex"),$("#scheduled-info-text").html(`\n        Név: ${data.name} <br>\n        Email: ${data.email} <br>\n        Telefon: ${data.phone} <br>\n        Megjegyzés: ${data.desc} <br>\n        Kupon kód: ${data.coupon}\n    `)}function closeAdminForm(){$(".schedule-info").css("display","none"),closePanel()}function getOpenHoursWithParam(date){gHours=[],$.post(apiUrl+"getOpenHours.php",{day:date},(res,status)=>{let start=Number(res.opening),end=res.closing,diff;diff=start>end?24-Number(start)+Number(end):end-start;for(let i=0;i<diff;i+=2){let d=new Date;d.setHours(Number(start)+i);let hours=d.getHours();gHours.push(hours)}})}function changeCurrentDate(dayCh){let newDate,cd=new Date(date).addDays(dayCh),year,month,day,dateString=cd.getFullYear()+"-"+(cd.getMonth()<9?"0"+Number(cd.getMonth()+1):Number(cd.getMonth()+1))+"-"+(cd.getDate()<9?"0"+cd.getDate():cd.getDate());date=dateString,getFreePos(dateString),getOpenHoursWithParam(cd.getDay()),$("#currentDate").text(dateString),$("#newdate").val(dateString),sessionStorage.date=date}function gohome(){let newD=new Date,year,month,day,dateString=newD.getFullYear()+"-"+(newD.getMonth()<9?"0"+Number(newD.getMonth()+1):Number(newD.getMonth()+1))+"-"+(newD.getDate()<9?"0"+newD.getDate():newD.getDate());date=dateString,getFreePos(dateString),getOpenHoursWithParam(newD.getDay()),$("#currentDate").text(dateString),$("#newdate").val(dateString),sessionStorage.date=date}$(".game-type").click((function(e){e.preventDefault()})),Date.prototype.addDays=function(days){var date=new Date(this.valueOf());return date.setDate(date.getDate()+days),date};